[build]
builder = "nixpacks"
buildCommand = """
corepack enable && \
corepack prepare pnpm@9.15.0 --activate && \
pnpm install && \
pnpm --filter @cdc-fotus/types build && \
cd backend && pnpm db:generate && pnpm build
"""

[deploy]
startCommand = "cd backend && pnpm db:push && node dist/main.js"
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[variables]
NODE_ENV = "production"
HOST = "0.0.0.0"
LOG_LEVEL = "info"
